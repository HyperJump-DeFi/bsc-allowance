{"mappings":"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","sources":["./src/js/abi.js","./src/js/networkSettings.js","./src/js/index.js"],"sourcesContent":["export const ERC20_ABI = [\n  {\n    \"constant\": true,\n    \"inputs\": [],\n    \"name\": \"name\",\n    \"outputs\": [\n      {\n        \"name\": \"\",\n        \"type\": \"string\"\n      }\n    ],\n    \"payable\": false,\n    \"type\": \"function\"\n  },\n  {\n    \"constant\": true,\n    \"inputs\": [],\n    \"name\": \"decimals\",\n    \"outputs\": [\n      {\n        \"name\": \"\",\n        \"type\": \"uint8\"\n      }\n    ],\n    \"payable\": false,\n    \"type\": \"function\"\n  },\n  {\n    \"constant\": true,\n    \"inputs\": [\n      {\n        \"name\": \"_owner\",\n        \"type\": \"address\"\n      }\n    ],\n    \"name\": \"balanceOf\",\n    \"outputs\": [\n      {\n        \"name\": \"balance\",\n        \"type\": \"uint256\"\n      }\n    ],\n    \"payable\": false,\n    \"type\": \"function\"\n  },\n  {\n    \"constant\": true,\n    \"inputs\": [],\n    \"name\": \"symbol\",\n    \"outputs\": [\n      {\n        \"name\": \"\",\n        \"type\": \"string\"\n      }\n    ],\n    \"payable\": false,\n    \"type\": \"function\"\n  }\n];\n\nexport const approvalABI = [\n  {\n    \"constant\": false,\n    \"inputs\": [\n      {\n        \"internalType\": \"address\",\n        \"name\": \"spender\",\n        \"type\": \"address\"\n      },\n      {\n        \"internalType\": \"uint256\",\n        \"name\": \"tokens\",\n        \"type\": \"uint256\"\n      }\n    ],\n    \"name\": \"approve\",\n    \"outputs\": [\n      {\n        \"internalType\": \"bool\",\n        \"name\": \"success\",\n        \"type\": \"bool\"\n      }\n    ],\n    \"payable\": false,\n    \"stateMutability\": \"nonpayable\",\n    \"type\": \"function\"\n  }\n];\n","export default {\n  1: {\n    chainId: '0x38',\n    chainName: 'BSC Mainnet',\n    nativeCurrency: {\n      name: 'Binance Coin',\n      symbol: 'BNB',\n      decimals: 18,\n    },\n    rpcUrls: ['https://bsc-dataseed.binance.org'],\n    blockExplorerUrls: ['https://bscscan.com/'],\n  },\n  56: {\n    chainId: '0x38',\n    chainName: 'BSC Mainnet',\n    nativeCurrency: {\n      name: 'Binance Coin',\n      symbol: 'BNB',\n      decimals: 18,\n    },\n    rpcUrls: ['https://bsc-dataseed.binance.org'],\n    blockExplorerUrls: ['https://bscscan.com/']\n  },\n  97: {\n    chainId: '0x38',\n    chainName: 'BSC Mainnet',\n    nativeCurrency: {\n      name: 'Binance Coin',\n      symbol: 'BNB',\n      decimals: 18,\n    },\n    rpcUrls: ['https://bsc-dataseed.binance.org'],\n    blockExplorerUrls: ['https://bscscan.com/']\n  },\n  250: {\n    chainId: '0xFA',\n    chainName: 'FANTOM Mainnet',\n    nativeCurrency: {\n      name: 'Fantom',\n      symbol: 'FTM',\n      decimals: 18,\n    },\n    rpcUrls: ['https://rpcapi.fantom.network'],\n    blockExplorerUrls: ['https://ftmscan.com/']\n  }\n};\n","import { ERC20_ABI, approvalABI } from './abi';\nimport networkSettings from './networkSettings';\n\nconst approvalHash = \"0x095ea7b3\";\nconst unlimitedAllowance = \"ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\";\n\n// -- Web3Modal\nconst Web3Modal = window.Web3Modal.default;\nconst WalletConnectProvider = window.WalletConnectProvider.default;\n\nlet web3Modal;\nlet provider;\n\nconst providerOptions = {\n  walletconnect: {\n    package: WalletConnectProvider,\n    options: {\n      rpc: {\n        1: 'https://bsc-dataseed.binance.org/',\n        56: 'https://bsc-dataseed.binance.org/',\n        97: 'https://data-seed-prebsc-1-s1.binance.org:8545/',\n        250: 'https://rpcapi.fantom.network'\n      },\n    },\n  },\n};\n\nconst inject = async () => {\n  if (window.ethereum) {\n    window.web3 = new Web3(window.ethereum);\n    window.ethereum.enable();\n    return true;\n  } else {\n    try {\n      web3Modal = new Web3Modal({\n        cacheProvider: false,\n        providerOptions,\n        disableInjectedProvider: false, // optional. For MetaMask / Brave / Opera.\n      });\n\n      provider = await web3Modal.connect();\n      window.web3 = new Web3(provider);\n\n      return true;\n    } catch (err) {\n      console.error(err);\n    }\n  }\n\n  return false;\n};\n\nasync function onChainChange(chainId) {\n  $(\"#results\").children().not(':first').remove();\n  await inject();\n  await onReady();\n}\n\nfunction initialise() {\n  (async () => {\n    const injected = await inject();\n    if (!injected) {\n      alert(\"web3 object not found\");\n      return;\n    }\n    if (window.web3.currentProvider) {\n      window.web3.currentProvider.on(\"chainChanged\", async (chainId) => {\n        await onChainChange(chainId);\n      });\n    }\n    onReady();\n  })();\n}\n\nasync function onReady() {\n  let settings;\n  try {\n    const chainId = await window.web3.eth.getChainId();\n    settings = networkSettings[chainId];\n    if (!settings) {\n      alert(`Error: chain ID ${chainId} is not supported`);\n      return;\n    }\n  } catch (e) {\n    alert(`Cannot connect to network: ${e.message}`);\n    return;\n  }\n\n  document.querySelector(\"#connect-btn\").style.display = \"none\";\n  document.querySelector(\"#disconnect-btn\").style.display = \"block\";\n  window.web3.eth.requestAccounts().then((accounts) => {\n    init(accounts[0]);\n  }).catch((err) => {\n    console.log(err);\n    // some web3 objects don't have requestAccounts\n    if (!window.ethereum) {\n      return;\n    }\n    window.ethereum.enable().then((accounts) => {\n      init(accounts[0]);\n    }).catch((err) => {\n      alert(e + err);\n    });\n  });\n\n  function init(account) {\n    window.web3.eth\n      .getChainId()\n      .then((chainId) => {\n        let query = getQuery(chainId, account);\n        if(query === \"\") {\n          alert(`No allowances found in chain(${chainId}) for ${account}`);\n\n        } else {\n          getApproveTransactions(query, (txs) => {\n            // display the logic\n            // console.log(txs);\n            buildResults(chainId, txs, account);\n          });\n        }\n      }).catch((err) => {\n        throw err;\n      });\n  }\n\n  function getQuery(chainId, address) {\n    const apiAddress = chainId === 250 ? 'ftmscan.com' : 'bscscan.com';\n    return `https://api.${apiAddress}/api?module=account&action=txlist&address=${address}`;\n  }\n\n  function getExplorerPage(chainId) {\n    return `${settings.blockExplorerUrls[0]}address/`;\n  }\n\n  function getApproveTransactions(query, cb) {\n    fetch(query)\n      .then(data => data.text())\n      .then(text => {\n        let approveTransactions = [];\n        let dataObj = JSON.parse(text).result;\n\n        for (let tx of dataObj) {\n\n          if (tx.input && tx.input.includes(approvalHash)) {\n            let approveObj = {};\n            approveObj.contract = web3.utils.toChecksumAddress(tx.to);\n            approveObj.approved = web3.utils.toChecksumAddress(\"0x\" + tx.input.substring(34, 74));\n\n            const contract = new web3.eth.Contract(ERC20_ABI, approveObj.contract);\n            contract.methods.symbol().call().then(symbol => {\n              $(\"#results\").find(`#${approveObj.contract} .grid-symbol`).html(`<span>${symbol}</span>`);\n            });\n\n            let allowance = tx.input.substring(74);\n            if (allowance.includes(unlimitedAllowance)) {\n              approveObj.allowance = \"unlimited\";\n            } else {\n              approveObj.allowance = \"limited\";\n            }\n\n            if (parseInt(allowance, 16) !== 0) {\n              approveTransactions.push(approveObj);\n            } else {\n              // TODO clean up\n              // Remove all previous additions of this approval transaction as it is now cleared up\n              approveTransactions = approveTransactions.filter((val) => {\n                return !(val.approved === approveObj.approved && val.contract === val.contract);\n              });\n            }\n\n          }\n        }\n        cb(approveTransactions);\n      });\n  }\n\n  function buildResults(chainId, txs, account) {\n    let explorerURL = getExplorerPage(chainId);\n    let parentElement = $('#results');\n    for (let index in txs) {\n      parentElement.append(`\n        <div class=\"grid-container\" id=\"${txs[index].contract}\">\n        <div class=\"grid-symbol\"></div>\n        <div class=\"grid-address\"><a href=${explorerURL + txs[index].contract} target=\"_blank\" rel=\"noopener noreferrer\">${txs[index].contract}</a></div>\n        <div class=\"grid-address\"><a href=${explorerURL + txs[index].approved} target=\"_blank\" rel=\"noopener noreferrer\">${txs[index].approved}</a></div>\n        <div class=\"grid-action\"><span class=\"${txs[index].allowance}\">${txs[index].allowance}</span><button class=\"${txs[index].allowance}\" id=\"revoke${index}\"> Revoke</button></div>\n        </div>\n        `);\n      setRevokeButtonClick(txs[index], \"#revoke\" + index, account);\n    }\n  }\n\n  function setRevokeButtonClick(tx, id, account) {\n    $(id).click(() => {\n      let contract = new window.web3.eth.Contract(approvalABI, tx.contract);\n      contract.methods.approve(tx.approved, 0).send({ from: account }).then((receipt) => {\n        console.log(\"revoked: \" + JSON.stringify(receipt));\n        $(id).parents('.grid-container').remove();\n      }).catch((err) => {\n        console.log(\"failed: \" + JSON.stringify(err));\n      });\n    });\n  }\n\n  function onRevokeAll() {\n    $('.grid-action button').trigger('click');\n  }\n\n  function onRevoke10() {\n    const $btns = $('.grid-action button');\n    $btns.slice(0, Math.min(10, $btns.length)).trigger('click');\n  }\n\n  $('.revoke-10-btn').click(onRevoke10);\n  $('.revoke-all-btn').click(onRevokeAll);\n  $(\"#disconnect-btn\").click(handleDisconnection);\n}\n\n$(\"#connect-btn\").click(async () => {\n  await handleConnection();\n});\n\nasync function handleDisconnection() {\n  await disconnect();\n  $(\"#results\").children().not(':first').remove();\n  document.querySelector(\"#connect-btn\").style.display = \"block\";\n  document.querySelector(\"#disconnect-btn\").style.display = \"none\";\n}\n\nasync function handleConnection() {\n  await inject();\n  await onReady();\n}\n\nasync function disconnect() {\n  const foundProvider = provider || window.web3.currentProvider;\n\n  if (!foundProvider) {\n    console.log(\"No provider found\");\n    return;\n  }\n\n  if (foundProvider.close) {\n    console.log(\"Killing the wallet connection\", foundProvider);\n    await foundProvider.close();\n\n    await web3Modal.clearCachedProvider();\n  }\n  provider = null;\n  window.web3.currentProvider = null;\n}\n\n$(initialise);\n"],"names":["$74e15bb16ab7954bb023495dab687a73$export$ERC20_ABI","constant","inputs","name","outputs","type","payable","$74e15bb16ab7954bb023495dab687a73$export$approvalABI","internalType","stateMutability","1","chainId","chainName","nativeCurrency","symbol","decimals","rpcUrls","blockExplorerUrls","56","97","250","$f6dfaefb9e5b052f09219a53921da9fa$var$approvalHash","$f6dfaefb9e5b052f09219a53921da9fa$var$unlimitedAllowance","$f6dfaefb9e5b052f09219a53921da9fa$var$Web3Modal","window","Web3Modal","default","$f6dfaefb9e5b052f09219a53921da9fa$var$web3Modal","$f6dfaefb9e5b052f09219a53921da9fa$var$provider","$f6dfaefb9e5b052f09219a53921da9fa$var$providerOptions","walletconnect","package","WalletConnectProvider","options","rpc","$f6dfaefb9e5b052f09219a53921da9fa$var$inject","async","ethereum","web3","Web3","enable","cacheProvider","providerOptions","disableInjectedProvider","connect","err","console","error","$f6dfaefb9e5b052f09219a53921da9fa$var$onReady","settings","eth","getChainId","alert","e","message","init","account","then","query","address","getQuery","cb","fetch","data","text","approveTransactions","dataObj","JSON","parse","result","tx","input","includes","approveObj","contract","utils","toChecksumAddress","to","approved","substring","Contract","methods","call","$","find","html","allowance","parseInt","push","filter","val","getApproveTransactions","txs","explorerURL","parentElement","index","append","setRevokeButtonClick","buildResults","catch","id","click","approve","send","from","receipt","log","stringify","parents","remove","document","querySelector","style","display","requestAccounts","accounts","$btns","slice","Math","min","length","trigger","$f6dfaefb9e5b052f09219a53921da9fa$var$handleDisconnection","foundProvider","currentProvider","close","clearCachedProvider","$f6dfaefb9e5b052f09219a53921da9fa$var$disconnect","children","not","$f6dfaefb9e5b052f09219a53921da9fa$var$handleConnection","on","$f6dfaefb9e5b052f09219a53921da9fa$var$onChainChange"],"version":3,"file":"index.9dd87241.js.map"}