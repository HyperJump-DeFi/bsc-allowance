{"mappings":"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","sources":["./src/js/abi.js","./src/js/networkSettings.js","./src/js/index.js"],"sourcesContent":["export const ERC20_ABI = [\n  {\n    \"constant\": true,\n    \"inputs\": [],\n    \"name\": \"name\",\n    \"outputs\": [\n      {\n        \"name\": \"\",\n        \"type\": \"string\"\n      }\n    ],\n    \"payable\": false,\n    \"type\": \"function\"\n  },\n  {\n    \"constant\": true,\n    \"inputs\": [],\n    \"name\": \"decimals\",\n    \"outputs\": [\n      {\n        \"name\": \"\",\n        \"type\": \"uint8\"\n      }\n    ],\n    \"payable\": false,\n    \"type\": \"function\"\n  },\n  {\n    \"constant\": true,\n    \"inputs\": [\n      {\n        \"name\": \"_owner\",\n        \"type\": \"address\"\n      }\n    ],\n    \"name\": \"balanceOf\",\n    \"outputs\": [\n      {\n        \"name\": \"balance\",\n        \"type\": \"uint256\"\n      }\n    ],\n    \"payable\": false,\n    \"type\": \"function\"\n  },\n  {\n    \"constant\": true,\n    \"inputs\": [],\n    \"name\": \"symbol\",\n    \"outputs\": [\n      {\n        \"name\": \"\",\n        \"type\": \"string\"\n      }\n    ],\n    \"payable\": false,\n    \"type\": \"function\"\n  }\n];\n\nexport const approvalABI = [\n  {\n    \"constant\": false,\n    \"inputs\": [\n      {\n        \"internalType\": \"address\",\n        \"name\": \"spender\",\n        \"type\": \"address\"\n      },\n      {\n        \"internalType\": \"uint256\",\n        \"name\": \"tokens\",\n        \"type\": \"uint256\"\n      }\n    ],\n    \"name\": \"approve\",\n    \"outputs\": [\n      {\n        \"internalType\": \"bool\",\n        \"name\": \"success\",\n        \"type\": \"bool\"\n      }\n    ],\n    \"payable\": false,\n    \"stateMutability\": \"nonpayable\",\n    \"type\": \"function\"\n  }\n];\n","export default {\n  1: {\n    chainId: '0x38',\n    chainName: 'BSC Mainnet',\n    nativeCurrency: {\n      name: 'Binance Coin',\n      symbol: 'BNB',\n      decimals: 18,\n    },\n    rpcUrls: ['https://bsc-dataseed.binance.org'],\n    blockExplorerUrls: ['https://bscscan.com/'],\n  },\n  56: {\n    chainId: '0x38',\n    chainName: 'BSC Mainnet',\n    nativeCurrency: {\n      name: 'Binance Coin',\n      symbol: 'BNB',\n      decimals: 18,\n    },\n    rpcUrls: ['https://bsc-dataseed.binance.org'],\n    blockExplorerUrls: ['https://bscscan.com/']\n  },\n  97: {\n    chainId: '0x38',\n    chainName: 'BSC Mainnet',\n    nativeCurrency: {\n      name: 'Binance Coin',\n      symbol: 'BNB',\n      decimals: 18,\n    },\n    rpcUrls: ['https://bsc-dataseed.binance.org'],\n    blockExplorerUrls: ['https://bscscan.com/']\n  },\n  250: {\n    chainId: '0xFA',\n    chainName: 'FANTOM Mainnet',\n    nativeCurrency: {\n      name: 'Fantom',\n      symbol: 'FTM',\n      decimals: 18,\n    },\n    rpcUrls: ['https://rpcapi.fantom.network'],\n    blockExplorerUrls: ['https://ftmscan.com/']\n  }\n};\n","import { ERC20_ABI, approvalABI } from './abi';\nimport networkSettings from './networkSettings';\n\nconst approvalHash = \"0x095ea7b3\";\nconst unlimitedAllowance = \"ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\";\n\n// -- Web3Modal\nconst Web3Modal = window.Web3Modal.default;\nconst WalletConnectProvider = window.WalletConnectProvider.default;\n\nlet web3Modal;\nlet provider;\n\nconst providerOptions = {\n  walletconnect: {\n    package: WalletConnectProvider,\n    options: {\n      rpc: {\n        1: 'https://bsc-dataseed.binance.org/',\n        56: 'https://bsc-dataseed.binance.org/',\n        97: 'https://data-seed-prebsc-1-s1.binance.org:8545/',\n        250: 'https://rpcapi.fantom.network'\n      },\n    },\n  },\n};\n\nconst inject = async () => {\n  if (window.ethereum) {\n    window.web3 = new Web3(window.ethereum);\n    window.ethereum.enable();\n    return true;\n  } else {\n    try {\n      web3Modal = new Web3Modal({\n        cacheProvider: false,\n        providerOptions,\n        disableInjectedProvider: false, // optional. For MetaMask / Brave / Opera.\n      });\n\n      provider = await web3Modal.connect();\n      window.web3 = new Web3(provider);\n\n      return true;\n    } catch (err) {\n      console.error(err);\n    }\n  }\n\n  return false;\n};\n\nasync function onChainChange(chainId) {\n  $(\"#results\").children().not(':first').remove();\n  await inject();\n  await onReady();\n}\n\nfunction initialise() {\n  (async () => {\n    const injected = await inject();\n    if (!injected) {\n      alert(\"web3 object not found\");\n      return;\n    }\n    if (window.web3.currentProvider) {\n      window.web3.currentProvider.on(\"chainChanged\", async (chainId) => {\n        await onChainChange(chainId);\n      });\n    }\n    onReady();\n  })();\n}\n\nasync function onReady() {\n  const web3 = window.web3;\n  const chainId = await web3.eth.getChainId();\n  let settings = networkSettings[chainId];\n  if (!settings) {\n    alert(`Error: chain ID ${chainId} is not supported`);\n    return;\n  }\n  try {\n    await web3.eth.currentProvider\n      .request({\n        method: 'wallet_addEthereumChain',\n        params: [settings]\n      });\n  } catch (e) {\n    alert(`Cannot connect to network: ${e.message}`);\n    return;\n  }\n\n  document.querySelector(\"#connect-btn\").style.display = \"none\";\n  web3.eth.requestAccounts().then((accounts) => {\n    init(accounts[0]);\n    document.querySelector(\"#disconnect-btn\").style.display = \"block\";\n  }).catch((err) => {\n    console.log(err);\n    // some web3 objects don't have requestAccounts\n    ethereum.enable().then((accounts) => {\n      init(accounts[0]);\n      document.querySelector(\"#disconnect-btn\").style.display = \"block\";\n    }).catch((err) => {\n      alert(e + err);\n    });\n  });\n\n  function init(account) {\n    web3.eth.getChainId().then((chainId) => {\n      return chainId;\n\n    }).then((chainId) => {\n      let query = getQuery(chainId, account);\n      if(query === \"\") {\n        alert(`No allowances found in chain(${chainId}) for ${account}`);\n\n      } else {\n        getApproveTransactions(query, (txs) => {\n          // display the logic\n          // console.log(txs);\n          buildResults(chainId, txs, account);\n        });\n      }\n    }).catch((err) => {\n      throw err;\n    });\n  }\n\n  function getQuery(chainId, address) {\n    const apiAddress = chainId === 250 ? 'ftmscan.com' : 'bscscan.com';\n    return `https://api.${apiAddress}/api?module=account&action=txlist&address=${address}`;\n  }\n\n  function getExplorerPage(chainId) {\n    return `${settings.blockExplorerUrls[0]}address/`;\n  }\n\n  function getApproveTransactions(query, cb) {\n    fetch(query)\n      .then(data => data.text())\n      .then(text => {\n        let approveTransactions = [];\n        let dataObj = JSON.parse(text).result;\n\n        for(let tx of dataObj) {\n\n          if(tx.input && tx.input.includes(approvalHash)) {\n            let approveObj = {};\n            approveObj.contract = web3.utils.toChecksumAddress(tx.to);\n            approveObj.approved = web3.utils.toChecksumAddress(\"0x\" + tx.input.substring(34, 74));\n\n            const contract = new web3.eth.Contract(ERC20_ABI, approveObj.contract);\n            contract.methods.symbol().call().then(symbol => {\n              $(\"#results\").find(`#${approveObj.contract} .grid-symbol`).html(`<span>${symbol}</span>`);\n            });\n\n            let allowance = tx.input.substring(74);\n            if(allowance.includes(unlimitedAllowance)) {\n              approveObj.allowance = \"unlimited\";\n            } else {\n              approveObj.allowance = \"limited\";\n            }\n\n            if(parseInt(allowance, 16) !== 0) {\n              approveTransactions.push(approveObj);\n            } else {\n              // TODO clean up\n              // Remove all previous additions of this approval transaction as it is now cleared up\n              approveTransactions = approveTransactions.filter((val) => {\n                return !(val.approved === approveObj.approved && val.contract === val.contract);\n              });\n            }\n\n          }\n        }\n        cb(approveTransactions);\n      });\n  }\n\n  function buildResults(chainId, txs, account) {\n    let explorerURL = getExplorerPage(chainId);\n    let parentElement = $('#results');\n    for(let index in txs) {\n      parentElement.append(`\n        <div class=\"grid-container\" id=\"${txs[index].contract}\">\n        <div class=\"grid-symbol\"></div>\n        <div class=\"grid-address\"><a href=${explorerURL + txs[index].contract} target=\"_blank\" rel=\"noopener noreferrer\">${txs[index].contract}</a></div>\n        <div class=\"grid-address\"><a href=${explorerURL + txs[index].approved} target=\"_blank\" rel=\"noopener noreferrer\">${txs[index].approved}</a></div>\n        <div class=\"grid-action\"><span class=\"${txs[index].allowance}\">${txs[index].allowance}</span><button class=\"${txs[index].allowance}\" id=\"revoke${index}\"> Revoke</button></div>\n        </div>\n        `);\n      setRevokeButtonClick(txs[index], \"#revoke\" + index, account);\n    }\n  }\n\n  function setRevokeButtonClick(tx, id, account) {\n    $(id).click(() => {\n      let contract = new web3.eth.Contract(approvalABI, tx.contract);\n      contract.methods.approve(tx.approved, 0).send({ from: account }).then((receipt) => {\n        console.log(\"revoked: \" + JSON.stringify(receipt));\n        $(id).parents('.grid-container').remove();\n      }).catch((err) => {\n        console.log(\"failed: \" + JSON.stringify(err));\n      });\n    });\n  }\n\n  function onRevokeAll() {\n    $('.grid-action button').trigger('click');\n  }\n\n  function onRevoke10() {\n    const $btns = $('.grid-action button');\n    $btns.slice(0, Math.min(10, $btns.length)).trigger('click');\n  }\n\n  $('.revoke-10-btn').click(onRevoke10);\n  $('.revoke-all-btn').click(onRevokeAll);\n  $(\"#disconnect-btn\").click(handleDisconnection);\n}\n\n$(\"#connect-btn\").click(async () => {\n  await handleConnection();\n});\n\nasync function handleDisconnection() {\n  await disconnect();\n  $(\"#results\").children().not(':first').remove();\n  document.querySelector(\"#connect-btn\").style.display = \"block\";\n  document.querySelector(\"#disconnect-btn\").style.display = \"none\";\n}\n\nasync function handleConnection() {\n  await inject();\n  await onReady();\n}\n\nasync function disconnect() {\n  const foundProvider = provider || window.web3.currentProvider;\n\n  if (!foundProvider) {\n    console.log(\"No provider found\");\n    return;\n  }\n\n  if (foundProvider.close) {\n    console.log(\"Killing the wallet connection\", foundProvider);\n    await foundProvider.close();\n\n    await web3Modal.clearCachedProvider();\n  }\n  provider = null;\n  window.web3.currentProvider = null;\n\n  selectedAccount = null;\n}\n\n$(initialise);\n"],"names":["$74e15bb16ab7954bb023495dab687a73$export$ERC20_ABI","constant","inputs","name","outputs","type","payable","$74e15bb16ab7954bb023495dab687a73$export$approvalABI","internalType","stateMutability","1","chainId","chainName","nativeCurrency","symbol","decimals","rpcUrls","blockExplorerUrls","56","97","250","$f6dfaefb9e5b052f09219a53921da9fa$var$approvalHash","$f6dfaefb9e5b052f09219a53921da9fa$var$unlimitedAllowance","$f6dfaefb9e5b052f09219a53921da9fa$var$Web3Modal","window","Web3Modal","default","$f6dfaefb9e5b052f09219a53921da9fa$var$web3Modal","$f6dfaefb9e5b052f09219a53921da9fa$var$provider","$f6dfaefb9e5b052f09219a53921da9fa$var$providerOptions","walletconnect","package","WalletConnectProvider","options","rpc","$f6dfaefb9e5b052f09219a53921da9fa$var$inject","async","ethereum","web3","Web3","enable","cacheProvider","providerOptions","disableInjectedProvider","connect","err","console","error","$f6dfaefb9e5b052f09219a53921da9fa$var$onReady","eth","getChainId","settings","currentProvider","request","method","params","e","alert","message","document","querySelector","style","display","requestAccounts","then","accounts","init","catch","log","$","click","$btns","slice","Math","min","length","trigger","$f6dfaefb9e5b052f09219a53921da9fa$var$handleDisconnection","account","query","address","getQuery","cb","fetch","data","text","approveTransactions","dataObj","JSON","parse","result","tx","input","includes","approveObj","contract","utils","toChecksumAddress","to","approved","substring","Contract","methods","call","find","html","allowance","parseInt","push","filter","val","getApproveTransactions","txs","explorerURL","parentElement","index","append","setRevokeButtonClick","buildResults","id","approve","send","from","receipt","stringify","parents","remove","foundProvider","close","clearCachedProvider","selectedAccount","$f6dfaefb9e5b052f09219a53921da9fa$var$disconnect","children","not","$f6dfaefb9e5b052f09219a53921da9fa$var$handleConnection","on","$f6dfaefb9e5b052f09219a53921da9fa$var$onChainChange"],"version":3,"file":"index.daa7e57f.js.map"}